# Agent Document 作成のための重要事項

本ドキュメントは、LLMに実務レベルで機能するAgent Document（AIに渡すコンテクストや命令が書かれた文書）を書かせるための設計原則を定義する。

## 1. 目的は「成果物定義」に落とす

出力ファイルパスを明示する。出力形式（Markdown / JSON 等）を固定する。必須セクションを列挙する。完了条件を測定可能に定義する。

例（良い）:
- `docs/issue/vX.Y.Z.md` を生成する
- テンプレート必須項目をすべて埋める

抽象的な品質表現は禁止。

---

## 2. 抽象語を使用しない

以下の語は禁止：`properly` / `appropriately` / `maintain` / `ensure` / `consider` / `follow best practices`

すべて検証可能な行為に変換する。

- × Maintain traceability
- ○ 各Acceptance CriteriaにRequirement IDを明記する

---

## 3. 出力構造を固定する

見出し構造を明示し、必須フィールドを列挙する。空欄を禁止する。自由記述領域を最小化する。

ただし、想定外の状況に対応するため例外パスを設ける：

```
通常フォーマット:
- Verified Files:
- Feasibility: High / Medium / Low
- Risks:
- Missing Dependencies:

例外（情報不足時）:
- 不明項目は「UNKNOWN」と明記する
- 推測は禁止する。UNKNOWN項目は確認タスクとして列挙する
```

可能であれば出力例を提示する（本ドキュメント末尾の付録参照）。

---

## 4. 完了判定をチェックリスト化する

理念ではなく、検証可能な条件で定義する。

Issueは以下を満たす場合のみ完了：

- [ ] 受け入れ基準が測定可能である
- [ ] 影響ファイルが列挙されている
- [ ] 未解決のCritical Blockerが存在しない
- [ ] テスト手順が明示されている

---

## 5. 禁止事項は代替行動とセットで明示する

禁止のみを記述しない。長いコンテキストでは禁止制約は機能しなくなりやすいため、代替行動を必ずセットで定義する。

| 禁止 | 代替行動 |
|------|----------|
| 推測で依存関係を書かない | 不明な依存関係は「UNKNOWN」と記載し、確認タスクとして列挙する |
| 新規トップレベルセクションを追加しない | 既存セクション内に追記する。収まらない場合は「UNKNOWN」として別途確認を求める |
| 実装を実行しない | 計画のみ記述し、末尾に「実装待ち」フラグを立てる |
| 未確認情報を事実として書かない | 検証信頼度（low / medium / high）を明記する |

---

## 6. フロー制御は最小化する

「順番どおり実行せよ」「各ステップで停止せよ」は原則不要。

必要な場合はモード切替として明示する：

```
MODE: DRAFT    → ドラフト作成のみ。実装・検証は禁止
MODE: VERIFY   → 技術検証のみ。ドラフト修正は禁止
MODE: PLAN     → 実装計画のみ。コード生成は禁止
```

---

## 7. 責務はエージェント／ツール単位で分離する

1プロンプト内で複数の責務を混在させない。マルチターンやツール呼び出しが絡む場合、責務分離はプロンプト単位ではなくエージェント／ツール単位で設計する。

```
Agent A: ドラフト作成
Agent B: 技術検証
Agent C: 実装計画
Agent D: 最終統合
```

各エージェントの入出力インターフェースを明示すること。

---

## 8. 思考役割指定より成果物拘束を優先する

人格指定は効果が弱い：

- × 「Lead Architectとして考えよ」

代わりに成果物条件を明示する：

- 実装手順は原子的であること（1手順＝1ファイル変更）
- ファイル単位で記述すること
- 具体的ツール呼び出しを列挙すること

---

## 9. 調査結果は構造化させる

自由形式は禁止。フォーマットを固定する：

```
- Verified Files:
- Feasibility: High / Medium / Low
- Verification Confidence: low / medium / high
- Risks:
- Missing Dependencies:
- Critical Blockers:
- UNKNOWN Items: （確認が必要な項目を列挙）
```

---

## 10. フォールバック条件を明示する

- 使用不可ツールの代替手段を定義する
- 検証信頼度（low / medium / high）を必ず記載させる
- 信頼度が low の場合は、その根拠と確認方法を明記させる

これによりハルシネーションを抑制する。

---

## 11. 粒度を明示する

曖昧な指示は禁止。

- × 実装計画を作成せよ
- ○ 変更対象ファイルごとに修正内容を記述する。変更範囲（関数名・行番号）を明示する。テストケースを列挙する

---

## 12. 未確定情報の扱いを定義する

- 不明項目は「UNKNOWN」と明記する
- 推測は禁止する
- 未確認情報を確定事項として記載しない
- UNKNOWNが存在する場合は、確認タスクとして末尾に列挙する

---

## 13. 冗長性を排除する

見出しと目的の重複を避ける。説明より拘束条件を優先する。

---

## 結論

優れたAgent Documentは、以下の特徴を持つ：

- 抽象語が存在しない
- 判定可能である
- 出力構造が固定されている
- 禁止事項に代替行動が定義されている
- 例外パスが定義されている
- フォールバックが定義されている
- 思想ではなく拘束条件で記述されている

---

## 付録：Agent Document サンプル

以下はこの原則に従って書かれたAGENTS.mdの最小例。

```markdown
# AGENTS.md

## MODE

`DRAFT` モードで動作する。実装・コード生成は禁止。

## 出力

- ファイル: `docs/issue/vX.Y.Z.md`
- フォーマット: Markdown
- 必須セクション: Summary / Acceptance Criteria / Affected Files / Test Steps / Blockers

## 完了条件

- [ ] Acceptance Criteriaに測定可能な条件が記載されている
- [ ] Affected Filesが列挙されている（不明な場合はUNKNOWNと記載）
- [ ] Critical Blockerが存在しない、または明示されている
- [ ] Test Stepsが手順として記載されている

## 禁止事項と代替行動

| 禁止 | 代替行動 |
|------|----------|
| 推測で依存関係を書く | UNKNOWNと記載し、確認タスクに列挙する |
| 実装を実行する | 計画のみ記述し「実装待ち」と明記する |
| 未確認情報を事実として書く | Verification Confidence: low と明記する |

## 調査結果フォーマット

- Verified Files:
- Feasibility: High / Medium / Low
- Verification Confidence: low / medium / high
- Risks:
- Missing Dependencies:
- Critical Blockers:
- UNKNOWN Items:

## フォールバック

- ツールが使用不可の場合: 代替手段を明記し、Verification Confidence を low とする
- 情報不足の場合: UNKNOWNとして確認タスクを生成する
```