---
id: v1.3.2
status: in-progress
created: 2026-02-17
fixed_commit: 
---

# Issue: Markdown Linter の TTY 判定によるリグレッション修正

## 概要
v1.3.1 で導入された `isTTY` 判定により、Gemini CLI の子プロセスとして実行される Markdown Linter が「非対話環境」と誤認され、目視レビューがスキップされる問題を修正する。

## 背景と問題点
Markdown Linter (`md.cjs`) は、VSCode を使用した「Human Linter」として実装されている。
v1.3.1 では CI 環境等でのハングアップを防ぐために `process.stdout.isTTY` による判定を導入したが、Gemini CLI が Hook を実行する際は標準入出力がパイプされるため、この値が常に `false` となり、対話セッション中であっても Linter が動作をスキップしていた。

## 解決策
- `md.cjs` から `isTTY` による判定を削除する。
- 代わりに `code` コマンド（VSCode CLI）がパス通っているかどうかの判定のみを継続し、利用可能な場合は常に目視レビューを試みる。
- 環境変数（例: `CI=true`）が設定されている場合は、明示的にスキップするロジックを追加して安全性を確保する。

## 実装内容詳細
- [ ] `hooks/scripts/linters/md.cjs` の修正:
    - `isTTY` チェックの削除。
    - `process.env.CI` による CI 環境の明示的スキップ。
    - `code` コマンドの存在確認の維持。
- [ ] `hooks/scripts/linter_hook.cjs` のデバッグログ出力の整理。

## ゴール
- Markdown ファイルへの書き込み時に、Gemini CLI セッションから正しく VSCode が起動し、編集待機が行われること。
- CI 環境（`CI=true`）では、期待通り Linter がスキップされ、処理が継続されること。
