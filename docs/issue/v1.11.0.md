---
id: v1.11.0
type: refactor
status: in-progress
created: 2026-02-20
fixed_commit: 
---

# Issue: `issue_crafter` スキルのカスタム・サブエージェントへの移行

## 概要
現在 `skills/issue_crafter/SKILL.md` として提供されている Issue 作成機能を、より自律的かつ高度な推論が可能なカスタム・サブエージェント（`agents/issue-crafter.md`）として再構築する。

## 背景と問題点
- **抽象的な指示の限界**: `SKILL.md` はメインエージェントの指示に従う「手順書」に近いが、複雑な Issue 作成にはより独立した専門性（裁判官のような客観性）を持つサブエージェントの方が適している。
- **ワークフローの固定化**: スキル形式では、メインエージェントが各ステップを呼び出す必要があるが、サブエージェント化することで、コンテキストに基づいたより柔軟な調査と文書作成を一つの「思考」として完結できる。

## 解決策
- `agents/issue-crafter.md` を新規作成し、`issue_crafter` スキルのワークフロー（調査、計画、文書作成）をプロンプトとして組み込む。
- `skills/issue_crafter/SKILL.md` を削除し、機能の重複を避ける。
- ユーザー（メインエージェント）からの最小限の指示で、`docs/issue/` の最新状況を確認し、適切な ID と内容を持つ Issue を生成する専門性を持たせる。

## 実装内容詳細
### 1. 新規サブエージェントの作成
- `agents/issue-crafter.md` を作成。
- YAML frontmatter 設定:
  - `name: issue-crafter`
  - `description: [Expert in creating technically-validated Issue documents]`
  - `kind: local`
  - `tools: [codebase_investigator, read_file, grep_search, write_file, replace]`
- 命令セット（Prompt）:
  - **汎用的なプロジェクト構造の理解**: `docs/issue/` ディレクトリ（または類似の構造）を自律的に探索し、`TEMPLATE.md` や `REVIEW.md` の有無を確認してから作業を開始させる。
  - **IDD フローの強制**: `Step 1 (Draft)` -> `Step 2 (Validate)` -> `Step 3 (Plan)` のシーケンスを自律的に実行させる。
  - **技術的検証**: `Step 2 (Validate)` において `codebase_investigator` を必ず使用し、実装の実現可能性を「現在のコードベース」に基づいて保証させる。

### 2. マニフェストの更新
- **不要**: `agents/` ディレクトリに配置された `.md` ファイルは Gemini CLI によって自動的に検出されるため、`gemini-extension.json` への明示的な登録は不要。

### 3. 旧スキルの削除
- `skills/issue_crafter/SKILL.md` を削除。
- `skills/issue_crafter/` ディレクトリ（および中身のファイル）を完全に削除。

### 4. ビルドと同期
- `npm run build` を実行し、`dist/` 成果物を更新。
- `node tools/sync-version.cjs` を実行し、マニフェスト間の整合性を保つ。

## ユーザー側の設定変更（マイグレーション）
- **実験的機能の有効化（必須: jintrick 担当）**:
  - カスタムサブエージェントを使用するには、ユーザー自身の `settings.json`（通常 `~/.gemini/settings.json`）で以下を有効にする必要がある。
    ```json
    {
      "experimental": {
        "enableAgents": true
      }
    }
    ```
- **旧スキルの削除**:
  - 拡張機能を更新（`gemini extensions update`）すれば、削除された `skills/issue_crafter` は自動的に消滅するため、ユーザー側の手動削除は不要。

## ゴール
- `issue-crafter` が、どのようなプロジェクトに投入されても、そのプロジェクトの Issue テンプレートとコードベースを理解し、高品質な Issue を生成できること。
- 人間の介入を最小限にし、技術的に破綻のない「実装準備完了」状態の Issue を出力すること。
- 既存の `issue_crafter` スキルがクリーンに削除され、新サブエージェントが正常に動作すること。

## テスト戦略
- **機能テスト**: `agents/issue-crafter.md` を呼び出し、テスト用の Issue（例: `v1.11.1-test.md`）が生成されるか確認。
- **整合性テスト**: `npm test` を実行し、既存のテスト（Linter等）に影響がないことを確認。
- **マニフェスト確認**: `gemini-extension.json` に新エージェントが正しく記載されているか目視確認。
