---
id: v1.11.0
type: refactor
status: completed
completed: 2026-02-20
created: 2026-02-20
fixed_commit: 
---

# Issue: `issue_crafter` スキルのカスタム・サブエージェントへの移行

## 概要
現在 `skills/issue_crafter/SKILL.md` として提供されている Issue 作成機能を、より自律的かつ高度な推論が可能なカスタム・サブエージェント（`agents/issue-crafter.md`）として再構築する。

## 背景と問題点
- **抽象的な指示の限界**: `SKILL.md` はメインエージェントの指示に従う「手順書」に近いが、複雑な Issue 作成にはより独立した専門性（裁判官のような客観性）を持つサブエージェントの方が適している。
- **ワークフローの固定化**: スキル形式では、メインエージェントが各ステップを呼び出す必要があるが、サブエージェント化することで、コンテキストに基づいたより柔軟な調査と文書作成を一つの「思考」として完結できる。

## 解決策
- **ハイブリッド・ナレッジ設計**: 知識ベースとしての「スキル」と、推論エンジンとしての「サブエージェント」を組み合わせる。
  - `skills/prompt_crafter/` を「知識提供専用スキル」として維持・強化。
  - `agents/issue-crafter.md` を「設計・起草用サブエージェント」として新設。
- **知識の動的ロード**: サブエージェントが `activate_skill` ツールを自律的に呼び出し、`agent-document-spec.md` 等のナレッジをその場でロードして Issue 作成に反映させる。

## 実装内容詳細
### 1. 新規サブエージェントの作成
- `agents/issue-crafter.md` を作成。
- YAML frontmatter 設定:
  - `name: issue-crafter`
  - `tools: [codebase_investigator, activate_skill, read_file, grep_search, write_file, replace]`
- ワークフロー指示:
  - **知識の取得**: 作業開始前に `prompt_crafter` スキルを起動し、`agent-document-spec.md` に基づいた最高品質の命令書設計を行うことを義務付ける。
  - **IDD フローの強制**: 調査、設計、文書生成、完了報告の一連のシーケンス。

### 2. ナレッジ・スキルの再構築 (`prompt_crafter`)
- **仕様書の作成と配置**:
  - `docs/reference/best-prompt.md` を `docs/reference/agent-document-spec.md` に変名し、原本とする。
  - `skills/prompt_crafter/references/` ディレクトリを作成し、`agent-document-spec.md` をコピーする。
- **スキルの再定義**:
  - `skills/prompt_crafter/SKILL.md` を全面的に書き換える。
  - 役割を「最高品質のプロンプト設計ナレッジ（`agent-document-spec.md`）の提供」に特化させ、エージェントが `activate_skill` した際に即座に適切な設計指針を RAG 経由で返せるように定義する。

### 3. 旧機能の移行と削除
- `skills/issue_crafter/` （旧・単体スキル）を削除し、サブエージェントへの移行を完了する。

### 4. ビルドと同期
- `npm run build` を実行し、`dist/` 成果物を更新。
- `node tools/sync-version.cjs` を実行し、マニフェスト間の整合性を保つ。

## ユーザー側の設定変更（マイグレーション）
- **実験的機能の有効化（必須: jintrick 担当）**:
  - カスタムサブエージェントを使用するには、ユーザー自身の `settings.json`（通常 `~/.gemini/settings.json`）で以下を有効にする必要がある。
    ```json
    {
      "experimental": {
        "enableAgents": true
      }
    }
    ```
- **旧スキルの削除**:
  - 拡張機能を更新（`gemini extensions update`）すれば、削除された `skills/issue_crafter` は自動的に消滅するため、ユーザー側の手動削除は不要。

## ゴール
- `issue-crafter` が、どのようなプロジェクトに投入されても、そのプロジェクトの Issue テンプレートとコードベースを理解し、高品質な Issue を生成できること。
- 人間の介入を最小限にし、技術的に破綻のない「実装準備完了」状態の Issue を出力すること。
- 既存の `issue_crafter` スキルがクリーンに削除され、新サブエージェントが正常に動作すること。

## テスト戦略
- **機能テスト**: `agents/issue-crafter.md` を呼び出し、テスト用の Issue（例: `v1.11.1-test.md`）が生成されるか確認。
- **整合性テスト**: `npm test` を実行し、既存のテスト（Linter等）に影響がないことを確認。
- **マニフェスト確認**: `gemini-extension.json` に新エージェントが正しく記載されているか目視確認。
