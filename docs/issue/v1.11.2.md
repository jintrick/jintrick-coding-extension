---
id: v1.11.2
type: fix
status: completed
created: 2026-02-20
completed: 2026-02-20
fixed_commit: HEAD
---

# Issue: `issue-crafter` サブエージェントの登録不具合と仕様誤認の修正

## 概要
`v1.11.0` で追加された `issue-crafter` サブエージェントが CLI から認識されず、またその原因を `gemini-extension.json` への登録漏れと誤認していた問題を修正する。

## 背景と問題点
1. **サブエージェントがロードされない**:
   - `agents/issue-crafter.md` を配置しても、CLI 再起動後に認識されなかった（`available_subagents` に現れない）。
2. **原因の誤認**:
   - 当初、`gemini-extension.json` に `agents` フィールドを追加する必要があると誤解し、マニフェスト登録漏れと判断してしまった（`v1.11.1`）。
3. **真因の特定**:
   - 実際には、`gemini-extension.json` への登録は不要であり、`agents/` ディレクトリに置くだけで自動認識される仕様だった。
   - 真の原因は、`agents/issue-crafter.md` の YAML フロントマター内 `tools` リストに、サブエージェントからは使用できない（または循環参照となる）`codebase_investigator` が含まれていたことだった。
   - 無効なツールが含まれていたため、エージェント定義全体のロードがスキップされていた。

## 解決策
### 1. ツール定義の修正
- `agents/issue-crafter.md` の `tools` リストから `codebase_investigator` を削除する。
- 代わりに、`read_file`, `grep_search` などのプリミティブなツールを使用して調査を行うように変更する。

### 2. プロンプトの修正
- `agents/issue-crafter.md` のシステムプロンプト内で `codebase_investigator` を使用するよう指示していた箇所を削除。
- 自律的に `read_file` 等を使って調査・検証を行う手順に書き換える。

### 3. マニフェストの仕様確認
- `gemini-extension.json` には `agents` フィールドは不要であることを確認し、誤った修正を行わない方針へ転換。

## 実装内容詳細
- `agents/issue-crafter.md`:
  - `tools` リストから `codebase_investigator` を削除。
  - プロンプト内の「`codebase_investigator` を使用し...」等の記述を「`read_file` や `grep_search` を駆使し...」に変更。

## 検証
- 修正後、CLI を再起動し `issue-crafter` がサブエージェントとして認識されることを確認。
- `issue-crafter` に指示を出し、`read_file` 等を使って自律的に調査を行い、Issue を作成できることを確認済み。

## ゴール
- `issue-crafter` が正常にロードされ、使用可能になること。
- 今後、サブエージェント定義において `codebase_investigator` を `tools` に含めないという知見が確立されること。
