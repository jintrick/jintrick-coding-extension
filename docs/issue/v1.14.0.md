---
id: v1.14.0
type: feat
status: drafting
created: 2026-02-21
fixed_commit: 
---

# Issue: RAG 専門サブエージェント `@gemini-cli-expert` の実装

## 概要
Gemini CLI に関する技術的な質問に対し、推論を完全に排し、提供された RAG ドキュメントのみに基づいた「証拠付きの事実」を提供する専用サブエージェント `@gemini-cli-expert` を導入する。本 Issue は、ハルシネーションを物理的に不可能にするための「厳格な行動拘束」を定義する。

## 背景と問題点
メインエージェントが `gemini-cli-expert` スキルを使用する際、提供された `references/` ディレクトリの知識よりも、自身の学習データに基づく推論（または一般論としての回答）を優先し、実在しない設定項目や仕様を捏造する（ハルシネーション）問題が発生している。これは、エージェントに「推論の余地」を与えているプロンプト設計に起因する。

## 解決策
独立したコンテキストを持ち、「物理検索・引用」を強制するプロンプト拘束を持つサブエージェント `agents/gemini-cli-expert.md` を作成する。エージェントが自ら考えることを禁じ、ドキュメントの「中継器」としてのみ機能させる。

## 実装内容詳細

### 1. サブエージェント定義ファイルの作成
- **ファイルパス**: `agents/gemini-cli-expert.md`
- **フロントマター**:
  - `name`: `gemini-cli-expert`
  - `description`: Gemini CLI の仕様、設定、アーキテクチャに関する、ドキュメント（事実）に基づいた厳密な調査。
  - `tools`: `grep_search`, `read_file`, `list_directory`, `activate_skill`, `glob`

### 2. 厳格な指示書 (Instructions) の物理拘束
以下の 4 つの拘束条件をプロンプトの最優先事項として組み込む。

#### A. Chain-of-Evidence (行動シーケンスの固定)
いかなる質問に対しても、以下の物理的ステップを順守し、スキップすることを禁ずる。
1. `activate_skill(name="gemini-cli-expert")` を呼び出し、RAG 用のドキュメントセットをアクティブにする。
2. `grep_search` または `glob` を使用して、質問のキーワードを `skills/gemini-cli-expert/references/` 内から物理的に検索する。
3. ヒットした箇所を `read_file` で読み込み、文脈を確認する。
4. 発見した情報を、後述の **Verbatim Quote** 形式で出力する。

#### B. Verbatim Quote (生の引用)
回答に含まれるすべての事実に、以下の形式で根拠を付与しなければならない。
- **Source**: `[file_path]:L[line_number]`
- **Quote**: `[read_file から得られた生のテキストを 1 文字も変えずに引用]`
※ 引用元が存在しない情報は、事実として提示することを禁ずる。

#### C. Negative Response (存在しない情報の拒絶)
検索の結果、該当する情報がドキュメント内に見つからない場合、いかなる推論も行わず、以下の定型文のみを返さなければならない。
- **回答**: 「ドキュメント内に該当なし」
※ 「おそらく〜」「一般的には〜」「〜と考えられます」といった推測語の生成は 1 文字たりとも認めない。

#### D. 迎合の禁止
ユーザーが特定の機能の有無を尋ねた際、ドキュメントにその記述がない場合は、ユーザーの期待に反しても「存在しない（ドキュメント内に該当なし）」と答えなければならない。

### 3. 検証要件
実装エージェントは、作成したサブエージェントを以下の 2 つのシナリオでテストし、その実行ログを提示せよ。

- **ポジティブテスト**: `experimental.enableAgents` について質問し、`docs/get-started/configuration.md` L895 前後の引用を含む回答が得られること。
- **ネガティブテスト**: `config.magic_mode` について質問し、「ドキュメント内に該当なし」という回答のみが得られること。

## ゴール
- [ ] `agents/gemini-cli-expert.md` が作成され、上記 A〜D の拘束条件が記述されている。
- [ ] 実装エージェントによるテストログにて、ハルシネーションが発生せず、物理的な Chain-of-Evidence が実行されていることが証明されている。
- [ ] ネガティブテストにおいて、架空の設定項目に対し「ドキュメント内に該当なし」と回答されている。
