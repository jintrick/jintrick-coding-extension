---
id: v1.2.0
status: in-progress
created: 2026-02-16
fixed_commit:
---

# Issue: gemini-cli-expert ドキュメント更新通知機能

## 概要
`gemini-cli-expert` スキルで使用しているドキュメントが、本家 `gemini-cli` リポジトリで更新された場合、それを検知してユーザー（開発者）に通知する機能を実装する。
自動更新は `discovery.json` の品質（AI要約）を損なうリスクがあるため行わず、通知に留める。

## 課題
- ドキュメントが古くなっていることに気づきにくい。
- 自動更新では高品質な要約を維持できない。

## 解決策
- `gemini-cli-expert` 起動時にフックを実行。
- 前回のチェックから一定時間（例: 24時間）経過していれば、リモートリポジトリの最新コミットを確認。
- ローカルのドキュメント（`discovery.json` に記録されたリビジョン等）と比較し、差異があれば通知を表示する。

## 実装内容詳細

### 1. フック (`hooks/scripts/expert_docs_hook.cjs`)
- **トリガー**: `activate_skill` (gemini-cli-expert)
- **ロジック**:
  1. `discovery.json` から `metadata.last_checked` と `metadata.commit_hash` を読み取る。
  2. `last_checked` から 24 時間経過していなければ終了。
  3. **GitHub API を使用して `docs/` ディレクトリの最新コミットを取得**:
     - URL: `https://api.github.com/repos/google-gemini/gemini-cli/commits?path=docs&per_page=1`
     - User-Agent ヘッダー必須。
  4. 取得した最新コミットの `sha` がローカルの `commit_hash` と異なれば、`systemMessage` で「ドキュメントの更新があります」と通知。
  5. `discovery.json` の `metadata.last_checked` を現在時刻に更新して保存（`commit_hash` は更新しないことで、ユーザーが手動更新するまで通知を続ける）。

### 2. `discovery.json` のメタデータ拡張
- `metadata` フィールドに `last_checked` と `commit_hash` を追加して管理する。

## ゴール
- [ ] ドキュメントに更新がある場合、スキル起動時に通知が表示される。
- [ ] 自動的なファイル書き換えは行われない。
