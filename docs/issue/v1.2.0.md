---
id: v1.2.0
status: in-progress
created: 2026-02-16
fixed_commit:
---

# Issue: gemini-cli-expert ドキュメント更新通知機能

## 概要
`gemini-cli-expert` スキルで使用しているドキュメントが、本家 `gemini-cli` リポジトリで更新された場合、それを検知してユーザー（人間）とエージェント（AI）の両方に通知する機能を実装する。

## 課題
- `BeforeTool` フックでの `systemMessage` は、ツールの実行結果によって表示がかき消されたり、エージェントがその存在を認識できなかったりする問題がある。
- 更新通知があったことをエージェントが認識できなければ、会話の中で適切なアドバイスができない。

## 解決策
- フックのイベントを **`AfterTool`** に変更し、スキルの有効化が完了した直後に実行する。
- **`systemMessage`** を使用してユーザー（人間）に通知を表示する。
- **`hookSpecificOutput.additionalContext`** を使用して、エージェント（AI）のコンテキストに更新情報を注入する。

## 実装内容詳細

### 1. フック構成 (`hooks/hooks.json`)
- `BeforeTool` ではなく **`AfterTool`** に配置する。
- マッチャーは `activate_skill` のまま。

### 2. フックロジック (`hooks/scripts/expert_docs_hook.cjs`)
- **トリガー**: `AfterTool` (activate_skill)
- **ロジック**:
  1. `discovery.json` から `metadata.last_checked` と `metadata.commit_hash` を読み取る。
  2. `last_checked` から 24 時間経過していなければ終了。
  3. GitHub API を使用して `docs/` ディレクトリの最新コミットを取得。
  4. 最新コミットの `sha` がローカルの `commit_hash` と異なれば、以下を返す：
     - `systemMessage`: ユーザー向けの更新通知メッセージ。
     - `hookSpecificOutput.additionalContext`: エージェント向けの「ドキュメントが更新されています」という情報。
  5. `discovery.json` の `metadata.last_checked` を現在時刻に更新して保存。

## ゴール
- [ ] ドキュメントに更新がある場合、スキル起動直後にユーザーに通知が表示される。
- [ ] エージェントが「ドキュメントに更新がある」ことを認識し、会話に反映できる。
