---
id: v1.19.0
type: refactor
status: in-progress
created: 2026-02-25
fixed_commit: 
---

# Issue: `idd_sync_hook` の廃止と `/done` コマンドによる明示的なリリース管理への移行

## 概要
脆弱な `run_shell_command` パースに基づく `idd_sync_hook.cjs` を廃止し、`/done <version>` コマンドと `release-manager` スキルを用いた、プロジェクト固有の `RELEASE.md` を尊重するリリース準備フローを導入する。

## 背景と問題点
- **パースの脆弱性**: `idd_sync_hook.cjs` はコミットメッセージのパースに依存しており、誤検知や柔軟性の欠如が課題。
- **結合の強すぎ**: リリース手順がフック内にハードコードされており、プロジェクトごとの手順の違いに対応できない。

## 解決策
1. **明示的コマンド化**: リリース処理を `/done <version>` というユーザーの明示的なアクションに移行する。
2. **スキルの導入 (`release-manager`)**: 
   - バージョンの決定論的な同期を実行。
   - **後続手順の委譲**: `RELEASE.md` を読み込み、そこに記述された手順に従って後続の作業を案内または実行する。
3. **フックの完全削除**: Hooks による自動同期を廃止。

## 実装内容詳細

### 1. `commands/done.toml` の新規作成
- **description**: 「指定されたバージョンでのリリース準備（同期、および RELEASE.md に基づく後続作業）を開始する」
- **prompt**: `release-manager` スキルを `activate_skill` し、引数 `{{args}}` (バージョン番号) を渡してワークフローを開始せよ。

### 2. `skills/release-manager/SKILL.md` の定義
以下の決定論的なフローを定義する。
1. `run_shell_command` で `node scripts/update_version.cjs <version>` を実行。
2. `read_file` で `RELEASE.md` の内容を確認する。
3. `RELEASE.md` が存在する場合、その内容に従いステージング、コミットコマンドの提示、または追加の検証手順を案内する。
4. `RELEASE.md` が存在しない場合、標準的なプロジェクト規約（`docs/reference/idd-flow.md` 等）に従い、リリース完了に向けた作業を案内する。

### 3. `skills/release-manager/scripts/update_version.cjs` の実装
- `package.json` および `gemini-extension.json` の `version` を確実に同期する純粋なロジック。

### 4. フックの削除とクリーンアップ
- `hooks/hooks.json` から `idd-sync-hook` を削除。
- `idd_sync_hook.cjs` および関連ディレクトリ (`idd_sync/`)、テストファイルを削除。

### 5. ドキュメント更新
- `docs/reference/idd-flow.md` のステージ 7 を、新フローに合わせて書き換える。

## ゴール
- [ ] `/done 1.19.0` 実行後、バージョンが同期され、且つ `RELEASE.md` に基づくリリース手順が案内されること。
- [ ] `git commit` 時の暗黙的な副作用（フック）が排除されていること。
- [ ] `docs/reference/idd-flow.md` が最新のリリース手順を反映していること。
