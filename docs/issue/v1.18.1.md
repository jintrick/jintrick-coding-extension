# v1.18.1: Python Linter のエンコーディング問題修正と回帰テストの導入

## 1. 概要 (Overview)
Windows 環境（win32）において、Python Linter が UTF-8 の入力を CP932 としてデコードしようとして `UnicodeDecodeError` を起こす致命的なバグを修正する。また、非 ASCII 文字を含むコードに対する回帰テストを導入し、テストの信頼性を向上させる。

## 2. 背景 (Background)
- **環境依存の失敗**: 前回の `v1.18.0` における Jules のテストはパスしたが、実環境（Windows）での書き込み時に `UnicodeDecodeError: 'cp932' codec can't decode...` が発生した。
- **不十分なテスト**: 既存のテストケースに非 ASCII 文字（日本語など）が含まれておらず、エンコーディングの不整合を検出できていなかった。

## 3. 解決策 (Solution)
1.  **`py.cjs` の堅牢化**: 
    - `LINTER_SCRIPT` の `sys.stdin.read()` を `sys.stdin.buffer.read().decode('utf-8', errors='replace')` に変更し、実行環境の locale に依存せず UTF-8 で入力を処理するように強制する。
    - または、Node.js の `spawnSync` において `env: { ...process.env, PYTHONIOENCODING: 'utf-8' }` を設定する。
2.  **回帰テストの新規作成**:
    - `tests/hooks/python_linter_encoding.test.js` を作成。
    - 日本語のコメント、文字列、および絵文字を含む Python コードが `valid: true` を返すことを検証する。
    - あえて `SyntaxError` を含む日本語コードを投げ、エラーメッセージが文字化けせずに `reason` に返ることを検証する。

## 4. 詳細 (Details)

### 4.1 `hooks/scripts/linters/py.cjs` (Python側修正)
```python
import ast, sys, builtins
try:
    # 標準入力をバイナリで読み込み、UTF-8で明示的にデコードする
    raw_input = sys.stdin.buffer.read().decode('utf-8', errors='replace')
    tree = ast.parse(raw_input)
except SyntaxError as e:
    ... (既存のエラー詳細化ロジック) ...
```

## 5. ゴール (Goal / Checklist)
- [ ] Windows 環境で非 ASCII 文字を含む Python コードの書き込みが成功する。
- [ ] 日本語の構文エラー時に、詳細なメッセージが文字化けせずに表示される。
- [ ] 新しく作成したエンコーディング・テストがパスする。

## 6. 検証 (Verification)
- `npm test` による新規テストの実行。
- 手動検証: `tests/exp/unicode.py`（日本語入り）の書き込み成功確認。
