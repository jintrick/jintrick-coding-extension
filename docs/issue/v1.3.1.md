---
id: v1.3.1
status: implemented
created: 2026-02-17
fixed_commit: 
---

# Issue: Markdown Human Linter の安定性向上 (CI/非対話環境対応)

## 概要
`v1.3.0` で導入した `code -w` による編集待機が、VSCode が未インストールの環境や、CI などの非対話環境でプロセスをハングさせるリスクを解消する。

## 背景と問題点
Jules による内部レビューにおいて、以下のセキュリティ・安定性上の懸念が指摘された。
- `code` コマンドが存在しない環境で `execSync` が失敗する。
- CI などの非対話環境で `code -w` が実行されると、ユーザーの入力を待ち続けてパイプラインがハングする可能性がある。

## 解決策
1. **コマンド存在確認**: `code` コマンドがパスに通っているか事前に確認し、存在しない場合はスキップする。
2. **対話環境判定**: TTY の有無や環境変数をチェックし、非対話環境では手動レビューをスキップして `allow` (valid: true) を返す。
3. **フォールバック**: 安全に実行できない状況では、通常の書き込み処理として継続させる。

## 実装内容詳細

### 1. `hooks/scripts/linters/md.cjs` の修正
- `process.stdout.isTTY` および `process.env.TERM` を使用して対話環境か判定する。
- `where code` (Windows) または `which code` (Unix) でコマンドの存在を確認する。
- 条件を満たさない場合はログを出力して `valid: true` を返す。

## ゴール
- [x] 非対話環境で `md.cjs` が実行されてもハングしない。
- [x] VSCode がない環境でもエラーで中断されず、通常の書き込みが行われる。
- [x] 対話環境かつ VSCode がある場合のみ、従来通り `code -w` と `deny` が機能する。
